<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2199px" preserveAspectRatio="none" style="width:1691px;height:2199px;background:#F5F5F5;" version="1.1" viewBox="0 0 1691 2199" width="1691px" zoomAndPan="magnify"><defs><filter height="300%" id="fjhn517no90iw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#F5F5F5" filter="url(#fjhn517no90iw)" height="949.0625" style="stroke: #000000; stroke-width: 2.0;" width="1474.5" x="93" y="811.3125"/><rect fill="#F5F5F5" height="874.6641" style="stroke: none; stroke-width: 1.0;" width="1474.5" x="93" y="885.7109"/><rect fill="#F5F5F5" filter="url(#fjhn517no90iw)" height="788.5938" style="stroke: #000000; stroke-width: 2.0;" width="1454.5" x="103" y="964.7813"/><rect fill="#F5F5F5" height="714.1953" style="stroke: none; stroke-width: 1.0;" width="1454.5" x="103" y="1039.1797"/><rect fill="#F5F5F5" filter="url(#fjhn517no90iw)" height="406.7969" style="stroke: #000000; stroke-width: 2.0;" width="1038.5" x="509" y="1339.5781"/><rect fill="#F5F5F5" height="173.6016" style="stroke: none; stroke-width: 1.0;" width="1038.5" x="509" y="1572.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="55" x2="55" y1="54.5938" y2="2143.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="178" x2="178" y1="54.5938" y2="2143.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="338" x2="338" y1="54.5938" y2="2143.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="624" x2="624" y1="54.5938" y2="2143.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1446.5" x2="1446.5" y1="54.5938" y2="2143.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1610.5" x2="1610.5" y1="54.5938" y2="2143.3672"/><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="15" y="22.9951">Servo Loop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="17.5" y="39.292">(1 ms tick)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="8" y="2142.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="15" y="2162.3623">Servo Loop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="17.5" y="2178.6592">(1 ms tick)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="113" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="131.5" y="22.9951">Needle State</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="120" y="39.292">(needle_state_t)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="113" y="2142.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="131.5" y="2162.3623">Needle State</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="120" y="2178.6592">(needle_state_t)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="253" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="260" y="22.9951">Mesa Needle Encoder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="298" y="39.292">(nsyn_enc)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="253" y="2142.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="260" y="2162.3623">Mesa Needle Encoder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="298" y="2178.6592">(nsyn_enc)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="519" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="593.5" y="22.9951">SewMac</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="526" y="39.292">(sewing_machine_control.c)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="519" y="2142.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="593.5" y="2162.3623">SewMac</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="526" y="2178.6592">(sewing_machine_control.c)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="1356.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="1396" y="22.9951">Step Projector</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="1363.5" y="39.292">(scurve_step_projector)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="1356.5" y="2142.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="1396" y="2162.3623">Step Projector</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="1363.5" y="2178.6592">(scurve_step_projector)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="1547.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="1578.5" y="22.9951">StepGen</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="1554.5" y="39.292">(Mesa stepgen)</text><rect fill="#FEFECE" filter="url(#fjhn517no90iw)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="1547.5" y="2142.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="1578.5" y="2162.3623">StepGen</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="1554.5" y="2178.6592">(Mesa stepgen)</text><rect fill="#EEEEEE" filter="url(#fjhn517no90iw)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1676.5" x="3" y="85.1602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1679.5" y1="85.1602" y2="85.1602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1679.5" y1="88.1602" y2="88.1602"/><rect fill="#EEEEEE" filter="url(#fjhn517no90iw)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="92" x="795.25" y="74.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="801.25" y="90.6606">Servo tick</text><polygon fill="#A80036" points="612,139.9922,622,143.9922,612,147.9922,616,143.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="55.5" x2="618" y1="143.9922" y2="143.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="62.5" y="123.7935">smc_process_sewing_machine(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="62.5" y="138.9263">&lt;&lt;entry&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="188.2578" y2="188.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="188.2578" y2="201.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="201.2578" y2="201.2578"/><polygon fill="#A80036" points="635,197.2578,625,201.2578,635,205.2578,631,201.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="631" y="168.0591">smc_update_dt(dt_now)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="631" y="183.1919">&lt;&lt;feedback, raw dt&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="245.5234" y2="245.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="245.5234" y2="258.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="258.5234" y2="258.5234"/><polygon fill="#A80036" points="635,254.5234,625,258.5234,635,262.5234,631,258.5234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="631" y="225.3247">smc_refresh_motion_limits()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="631" y="240.4575">&lt;&lt;plan, capped&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="302.7891" y2="302.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="302.7891" y2="315.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="315.7891" y2="315.7891"/><polygon fill="#A80036" points="635,311.7891,625,315.7891,635,319.7891,631,315.7891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="631" y="282.5903">smc_update_needle_feedback(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="631" y="297.7231">&lt;&lt;feedback mix&gt;&gt;</text><polygon fill="#A80036" points="189,356.0547,179,360.0547,189,364.0547,185,360.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183" x2="623" y1="360.0547" y2="360.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="195" y="339.856">need_needle_absolute_turns(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="195" y="354.9888">&lt;&lt;feedback, raw&gt;&gt;</text><polygon fill="#A80036" points="349,400.3203,339,404.3203,349,408.3203,345,404.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343" x2="623" y1="404.3203" y2="404.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="355" y="384.1216">nsyn_enc_get_needle_encoder_velocity()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="355" y="399.2544">&lt;&lt;feedback, raw&gt;&gt;</text><polygon fill="#A80036" points="189,444.5859,179,448.5859,189,452.5859,185,448.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183" x2="623" y1="448.5859" y2="448.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="195" y="428.3872">need_needle_velocity_rps(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="195" y="443.52">&lt;&lt;feedback, raw fallback&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="492.8516" y2="492.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="492.8516" y2="505.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="505.8516" y2="505.8516"/><polygon fill="#A80036" points="635,501.8516,625,505.8516,635,509.8516,631,505.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="631" y="472.6528">encoder_iir_update(turns, vel, -&gt; filtered)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="631" y="487.7856">&lt;&lt;feedback, alpha-capped&gt;&gt;</text><polygon fill="#A80036" points="1435,546.1172,1445,550.1172,1435,554.1172,1439,550.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="550.1172" y2="550.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="591" x="631" y="529.9185">mcsp_project_integrate_feedback(filtered_motor_pos, filtered_motor_vel, s_now_s, s_now_s)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="631" y="545.0513">&lt;&lt;feedback, capped&gt;&gt;</text><polygon fill="#A80036" points="1435,590.3828,1445,594.3828,1435,598.3828,1439,594.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="594.3828" y2="594.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="631" y="574.1841">pi_sp_innovation_pos(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="631" y="589.3169">&lt;&lt;feedback, estimator&gt;&gt;</text><polygon fill="#A80036" points="1435,634.6484,1445,638.6484,1435,642.6484,1439,638.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="638.6484" y2="638.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="631" y="618.4497">pi_sp_innovation_vel(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="631" y="633.5825">&lt;&lt;feedback, estimator&gt;&gt;</text><rect fill="#EEEEEE" filter="url(#fjhn517no90iw)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1676.5" x="3" y="667.2148"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1679.5" y1="667.2148" y2="667.2148"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1679.5" y1="670.2148" y2="670.2148"/><rect fill="#EEEEEE" filter="url(#fjhn517no90iw)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="181" x="750.75" y="656.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="756.75" y="672.7153">Move-up state control</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="726.0469" y2="726.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="726.0469" y2="739.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="739.0469" y2="739.0469"/><polygon fill="#A80036" points="635,735.0469,625,739.0469,635,743.0469,631,739.0469" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="631" y="705.8481">smc_run_state_machine(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="631" y="720.981">&lt;&lt;plan selection&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="783.3125" y2="783.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="783.3125" y2="796.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="796.3125" y2="796.3125"/><polygon fill="#A80036" points="635,792.3125,625,796.3125,635,800.3125,631,796.3125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="631" y="763.1138">smc_step_move_up(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="631" y="778.2466">&lt;&lt;plan decision&gt;&gt;</text><path d="M93,811.3125 L157,811.3125 L157,818.3125 L147,828.3125 L93,828.3125 L93,811.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="949.0625" style="stroke: #000000; stroke-width: 2.0;" width="1474.5" x="93" y="811.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="108" y="824.3794">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="172" y="823.5229">[Projector/needle missing]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="864.7109" y2="864.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="864.7109" y2="877.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="877.7109" y2="877.7109"/><polygon fill="#A80036" points="635,873.7109,625,877.7109,635,881.7109,631,877.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="631" y="844.5122">smc_move_up_transition_to_idle()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="631" y="859.645">&lt;&lt;plan state&gt;&gt;</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="93" x2="1567.5" y1="886.7109" y2="886.7109"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="98" y="896.9214">[Context available]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="936.7813" y2="936.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="936.7813" y2="949.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="949.7813" y2="949.7813"/><polygon fill="#A80036" points="635,945.7813,625,949.7813,635,953.7813,631,949.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="631" y="916.5825">smc_build_move_up_context(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="631" y="931.7153">&lt;&lt;feedback prep&gt;&gt;</text><path d="M103,964.7813 L167,964.7813 L167,971.7813 L157,981.7813 L103,981.7813 L103,964.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="788.5938" style="stroke: #000000; stroke-width: 2.0;" width="1454.5" x="103" y="964.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="118" y="977.8481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="182" y="976.9917">[Context build failed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1018.1797" y2="1018.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1018.1797" y2="1031.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1031.1797" y2="1031.1797"/><polygon fill="#A80036" points="635,1027.1797,625,1031.1797,635,1035.1797,631,1031.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="631" y="997.981">smc_move_up_transition_to_idle()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="631" y="1013.1138">&lt;&lt;plan state&gt;&gt;</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="103" x2="1557.5" y1="1040.1797" y2="1040.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="108" y="1050.3901">[Move-up evaluation]</text><polygon fill="#A80036" points="1435,1086.25,1445,1090.25,1435,1094.25,1439,1090.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="1090.25" y2="1090.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="631" y="1070.0513">mcsp_sp_estimated_state(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="631" y="1085.1841">&lt;&lt;feedback, KF estimate&gt;&gt;</text><polygon fill="#A80036" points="189,1130.5156,179,1134.5156,189,1138.5156,185,1134.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183" x2="623" y1="1134.5156" y2="1134.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="195" y="1114.3169">need_needle_phase_now(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="195" y="1129.4497">&lt;&lt;feedback, raw&gt;&gt;</text><polygon fill="#A80036" points="189,1174.7813,179,1178.7813,189,1182.7813,185,1178.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183" x2="623" y1="1178.7813" y2="1178.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="195" y="1158.5825">need_needle_get_up_phase(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="195" y="1173.7153">&lt;&lt;feedback, raw&gt;&gt;</text><polygon fill="#A80036" points="189,1219.0469,179,1223.0469,189,1227.0469,185,1223.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183" x2="623" y1="1223.0469" y2="1223.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="195" y="1202.8481">need_needle_is_safe(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="195" y="1217.981">&lt;&lt;feedback, raw&gt;&gt;</text><polygon fill="#A80036" points="189,1263.3125,179,1267.3125,189,1271.3125,185,1267.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183" x2="623" y1="1267.3125" y2="1267.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="195" y="1247.1138">need_needle_absolute_turns(needle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="195" y="1262.2466">&lt;&lt;feedback, raw&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1311.5781" y2="1311.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1311.5781" y2="1324.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1324.5781" y2="1324.5781"/><polygon fill="#A80036" points="635,1320.5781,625,1324.5781,635,1328.5781,631,1324.5781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="631" y="1291.3794">smc_mainshaft_delta_to_motor(ctx.delta_ms)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="631" y="1306.5122">&lt;&lt;plan conversion&gt;&gt;</text><path d="M509,1339.5781 L573,1339.5781 L573,1346.5781 L563,1356.5781 L509,1356.5781 L509,1339.5781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="406.7969" style="stroke: #000000; stroke-width: 2.0;" width="1038.5" x="509" y="1339.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="524" y="1352.645">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="588" y="1351.7886">[Capture window satisfied]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1392.9766" y2="1392.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1392.9766" y2="1405.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1405.9766" y2="1405.9766"/><polygon fill="#A80036" points="635,1401.9766,625,1405.9766,635,1409.9766,631,1405.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="631" y="1372.7778">smc_unsafe_force_hold()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="631" y="1387.9106">&lt;&lt;plan, raw hold&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1450.2422" y2="1450.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1450.2422" y2="1463.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1463.2422" y2="1463.2422"/><polygon fill="#A80036" points="635,1459.2422,625,1463.2422,635,1467.2422,631,1463.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="631" y="1430.0435">smc_planner_seed_state(hold_pos, 0.0)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="631" y="1445.1763">&lt;&lt;plan, raw hold&gt;&gt;</text><polygon fill="#A80036" points="1435,1503.5078,1445,1507.5078,1435,1511.5078,1439,1507.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="1507.5078" y2="1507.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="631" y="1487.3091">mcsp_sp_reset(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="631" y="1502.4419">&lt;&lt;plan reset&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1551.7734" y2="1551.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1551.7734" y2="1564.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1564.7734" y2="1564.7734"/><polygon fill="#A80036" points="635,1560.7734,625,1564.7734,635,1568.7734,631,1564.7734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="631" y="1531.5747">smc_move_up_transition_to_idle()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="631" y="1546.7075">&lt;&lt;plan state&gt;&gt;</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="509" x2="1547.5" y1="1573.7734" y2="1573.7734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="514" y="1583.9839">[Need new move-up plan]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1623.8438" y2="1623.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1623.8438" y2="1636.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1636.8438" y2="1636.8438"/><polygon fill="#A80036" points="635,1632.8438,625,1636.8438,635,1640.8438,631,1636.8438" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="631" y="1603.645">smc_compute_move_up_limits(&amp;ctx, &amp;v, &amp;a, &amp;j)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="631" y="1618.7778">&lt;&lt;plan, capped&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1681.1094" y2="1681.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1681.1094" y2="1694.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1694.1094" y2="1694.1094"/><polygon fill="#A80036" points="635,1690.1094,625,1694.1094,635,1698.1094,631,1694.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="631" y="1660.9106">smc_apply_move_up_plan(&amp;ctx, v, a, j)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="631" y="1676.0435">&lt;&lt;plan, capped&gt;&gt;</text><polygon fill="#A80036" points="1435,1734.375,1445,1738.375,1435,1742.375,1439,1738.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="1738.375" y2="1738.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="799" x="631" y="1718.1763">mcsp_project_move_to_abs_step(&amp;s_projector, s_now_s, ctx.target_abs_mot, 0.0, 0.0, v_plan_mot, a_plan_mot, j_plan_mot)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="631" y="1733.3091">&lt;&lt;plan build, capped&gt;&gt;</text><rect fill="#EEEEEE" filter="url(#fjhn517no90iw)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1676.5" x="3" y="1787.9414"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1679.5" y1="1787.9414" y2="1787.9414"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1679.5" y1="1790.9414" y2="1790.9414"/><rect fill="#EEEEEE" filter="url(#fjhn517no90iw)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="127" x="777.75" y="1777.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="783.75" y="1793.4419">Plan execution</text><polygon fill="#A80036" points="1435,1842.7734,1445,1846.7734,1435,1850.7734,1439,1846.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="1846.7734" y2="1846.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="631" y="1826.5747">mcsp_projection_refresh(&amp;s_projector, s_now_s)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="631" y="1841.7075">&lt;&lt;plan update, feedback&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="666" y1="1891.0391" y2="1891.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="666" y1="1891.0391" y2="1904.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="625" x2="666" y1="1904.0391" y2="1904.0391"/><polygon fill="#A80036" points="635,1900.0391,625,1904.0391,635,1908.0391,631,1904.0391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="631" y="1870.8403">smc_emit_motor_command()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="631" y="1885.9731">&lt;&lt;plan output&gt;&gt;</text><polygon fill="#A80036" points="1435,1944.3047,1445,1948.3047,1435,1952.3047,1439,1948.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="1948.3047" y2="1948.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="631" y="1928.106">mcsp_projection_lead_dt(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="631" y="1943.2388">&lt;&lt;plan, capped history&gt;&gt;</text><polygon fill="#A80036" points="1435,1988.5703,1445,1992.5703,1435,1996.5703,1439,1992.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="1992.5703" y2="1992.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="631" y="1972.3716">mcsp_project_command(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="631" y="1987.5044">&lt;&lt;plan sample&gt;&gt;</text><polygon fill="#A80036" points="1599,2032.8359,1609,2036.8359,1599,2040.8359,1603,2036.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1605" y1="2036.8359" y2="2036.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="631" y="2016.6372">nsyn_stp_set_sewmotor_pos_cmd(cmd.p)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="631" y="2031.77">&lt;&lt;plan, capped&gt;&gt;</text><polygon fill="#A80036" points="1435,2077.1016,1445,2081.1016,1435,2085.1016,1439,2081.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="2081.1016" y2="2081.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="631" y="2060.9028">mcsp_projection_eta(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="631" y="2076.0356">&lt;&lt;plan metric&gt;&gt;</text><polygon fill="#A80036" points="1435,2121.3672,1445,2125.3672,1435,2129.3672,1439,2125.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="1441" y1="2125.3672" y2="2125.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="631" y="2105.1685">mcsp_sp_estimated_state(&amp;s_projector)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="631" y="2120.3013">&lt;&lt;feedback, KF estimate&gt;&gt;</text><!--MD5=[408280a7ec5f32f8f7a7b950db1df2b5]
@startuml
skinparamlocked backgroundColor #f5f5f5
participant "Servo Loop\n(1 ms tick)" as Loop
participant "Needle State\n(needle_state_t)" as Needle
participant "Mesa Needle Encoder\n(nsyn_enc)" as Mesa
participant "SewMac\n(sewing_machine_control.c)" as Sew
participant "Step Projector\n(scurve_step_projector)" as Proj
participant "StepGen\n(Mesa stepgen)" as Stepgen

== Servo tick ==
Loop -> Sew: smc_process_sewing_machine(needle)\n<<entry>>
Sew -> Sew: smc_update_dt(dt_now)\n<<feedback, raw dt>>
Sew -> Sew: smc_refresh_motion_limits()\n<<plan, capped>>
Sew -> Sew: smc_update_needle_feedback(needle)\n<<feedback mix>>
Sew -> Needle: need_needle_absolute_turns(needle)\n<<feedback, raw>>
Sew -> Mesa: nsyn_enc_get_needle_encoder_velocity()\n<<feedback, raw>>
Sew -> Needle: need_needle_velocity_rps(needle)\n<<feedback, raw fallback>>
Sew -> Sew: encoder_iir_update(turns, vel, -> filtered)\n<<feedback, alpha-capped>>
Sew -> Proj: mcsp_project_integrate_feedback(filtered_motor_pos, filtered_motor_vel, s_now_s, s_now_s)\n<<feedback, capped>>
Sew -> Proj: pi_sp_innovation_pos(&s_projector)\n<<feedback, estimator>>
Sew -> Proj: pi_sp_innovation_vel(&s_projector)\n<<feedback, estimator>>

== Move-up state control ==
Sew -> Sew: smc_run_state_machine(needle)\n<<plan selection>>
Sew -> Sew: smc_step_move_up(needle)\n<<plan decision>>
alt Projector/needle missing
    Sew -> Sew: smc_move_up_transition_to_idle()\n<<plan state>>
else Context available
    Sew -> Sew: smc_build_move_up_context(needle)\n<<feedback prep>>
    alt Context build failed
        Sew -> Sew: smc_move_up_transition_to_idle()\n<<plan state>>
    else Move-up evaluation
        Sew -> Proj: mcsp_sp_estimated_state(&s_projector)\n<<feedback, KF estimate>>
        Sew -> Needle: need_needle_phase_now(needle)\n<<feedback, raw>>
        Sew -> Needle: need_needle_get_up_phase(needle)\n<<feedback, raw>>
        Sew -> Needle: need_needle_is_safe(needle)\n<<feedback, raw>>
        Sew -> Needle: need_needle_absolute_turns(needle)\n<<feedback, raw>>
        Sew -> Sew: smc_mainshaft_delta_to_motor(ctx.delta_ms)\n<<plan conversion>>

        alt Capture window satisfied
            Sew -> Sew: smc_unsafe_force_hold()\n<<plan, raw hold>>
            Sew -> Sew: smc_planner_seed_state(hold_pos, 0.0)\n<<plan, raw hold>>
            Sew -> Proj: mcsp_sp_reset(&s_projector)\n<<plan reset>>
            Sew -> Sew: smc_move_up_transition_to_idle()\n<<plan state>>
        else Need new move-up plan
            Sew -> Sew: smc_compute_move_up_limits(&ctx, &v, &a, &j)\n<<plan, capped>>
            Sew -> Sew: smc_apply_move_up_plan(&ctx, v, a, j)\n<<plan, capped>>
            Sew -> Proj: mcsp_project_move_to_abs_step(&s_projector, s_now_s, ctx.target_abs_mot, 0.0, 0.0, v_plan_mot, a_plan_mot, j_plan_mot)\n<<plan build, capped>>
        end
    end
end

== Plan execution ==
Sew -> Proj: mcsp_projection_refresh(&s_projector, s_now_s)\n<<plan update, feedback>>
Sew -> Sew: smc_emit_motor_command()\n<<plan output>>
Sew -> Proj: mcsp_projection_lead_dt(&s_projector)\n<<plan, capped history>>
Sew -> Proj: mcsp_project_command(&s_projector)\n<<plan sample>>
Sew -> Stepgen: nsyn_stp_set_sewmotor_pos_cmd(cmd.p)\n<<plan, capped>>
Sew -> Proj: mcsp_projection_eta(&s_projector)\n<<plan metric>>
Sew -> Proj: mcsp_sp_estimated_state(&s_projector)\n<<feedback, KF estimate>>
@enduml

PlantUML version 1.2020.02(Sun Mar 01 05:22:07 EST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.16+8-Debian-1deb12u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>